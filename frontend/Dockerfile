# frontend/Dockerfile

# --- 1. λΉλ“ λ‹¨κ³„ (Builder) ---
# Node.js 18 λ²„μ „μ„ λ² μ΄μ¤ μ΄λ―Έμ§€λ΅ μ‚¬μ©
FROM node:18-alpine AS builder

# μ‘μ—… λ””λ ‰ν† λ¦¬ μ„¤μ •
WORKDIR /app

# π”½ λΉλ“ μ‹μ μ— ν•„μ”ν• ν™κ²½ λ³€μλ¥Ό ARGλ΅ μ„ μ–Έν•©λ‹λ‹¤.
#    μ—¬λ¬ κ°κ°€ ν•„μ”ν•λ‹¤λ©΄ λ¨λ‘ μ„ μ–Έν•©λ‹λ‹¤.
ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
ARG NEXT_PUBLIC_API_BASE_URL

# π”½ μ„ μ–Έλ ARGλ¥Ό ENVλ΅ μ„¤μ •ν•μ—¬ λΉλ“ ν”„λ΅μ„Έμ¤κ°€ μ‚¬μ©ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.
ENV NEXT_PUBLIC_GOOGLE_CLIENT_ID=$NEXT_PUBLIC_GOOGLE_CLIENT_ID
ENV NEXT_PUBLIC_API_BASE_URL=$NEXT_PUBLIC_API_BASE_URL

# package.jsonκ³Ό package-lock.jsonμ„ λ¨Όμ € λ³µμ‚¬ν•μ—¬ μμ΅΄μ„± μΊμ‹± ν™μ©
COPY package*.json ./
RUN npm install

# λ‚λ¨Έμ§€ μ†μ¤ μ½”λ“ λ³µμ‚¬
COPY . .

# ν”„λ΅λ•μ…μ©μΌλ΅ λΉλ“
RUN npm run build


# --- 2. μ‹¤ν–‰ λ‹¨κ³„ (Runner) ---
# λ” κ°€λ²Όμ΄ μ΄λ―Έμ§€μ—μ„ λ‹¤μ‹ μ‹μ‘
FROM node:18-alpine

WORKDIR /app

# λΉλ“ λ‹¨κ³„μ—μ„ μƒμ„±λ κ²°κ³Όλ¬Όλ§ λ³µμ‚¬
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/public ./public

# μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‚¬μ©ν•  ν¬νΈ λ…μ‹
EXPOSE 3000

# μ»¨ν…μ΄λ„ μ‹μ‘ μ‹ μ‹¤ν–‰λ  λ…λ Ήμ–΄
CMD ["npm", "start"]